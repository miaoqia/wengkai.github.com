#pcDuino开机配置

ba5ag.kai at gmail.com 2014-11-16

拿到的pcDuino已经安装好了ubuntu，不过自己用还是需要一些初步的配置的。

#刷机

从官网 [http://www.pcduino.com]() 下载用于正确硬件的两个文件：一个img和一个.zip（或.7z，好像官网对于压缩用什么格式和软件不太在意）。我下载的时候，对于v3，这个文件是：`pcduino3_a20_kernel_dd_20140721.img` ；对于nano，这个文件是：`pcduino3_nano_a20_kernel_dd_20141030.img` 。

准备一个1GB的tf卡，不是必须1GB，是只要1GB就够了，更小的也可以，不过买不到了。把卡插入电脑，通常就被mount了，先要unmount（如果你的tf卡被识别为/dev/disk2，要知道被识别为什么了，可以sudo mount看一下）：

	sudo diskutil umount /dev/disk2s1

用dd把img写入一个

	sudo dd -if=xxx.img -of=/dev/disk1 -bs=1m

如果用Linux，上面的-bs=1m要换成-bs=1M。

另外准备一张2GB以上的tf卡，格式化成fat32，然后把另一个zip或7z文件解压到那个tf卡里。zip里面是两个文件，一个update.sh和一个.img，两个文件摊在tf卡的根下，不要目录。

现在把第一张tf卡插入pcd，开机或按reset键，会发现HDMI没有输出，而板上有一个LED开始慢速闪烁。这是它在把tf卡里的内容写入板上的flash。当闪烁结束，那个LED就熄灭了，这表示第一段结束。这时候要取出tf卡，但是暂时不插入第二张tf卡。

重新开机或reset，这次HDMI会有输出，等输出停下来，它会显示在寻找update.sh。此时插入第二张tf，它会找到，然后显示需要8分钟来刷新。等这个环节结束，它会告诉你已经更新完成。这时候取出tf卡，重新开机，就可以用上最新的内核和系统文件了。
配置

先做一个简单的配置，就是时区、时间和ip地址。

	sudo board-config.sh

这里可以做一些和板子相关的配置，最基本的要做一个时区的配置。
然后来配时间，以后可以安装ntp，在那之前先手工配一下时间，懒得学习，用懒人的办法，先：

	date

看一下时间：

	Sun Nov 16 13:36:16 CST 2014

然后按照这个格式来输入当前时间：

	sudo date -s "Sun Nov 16 13:36:16 CST 2014"

默认这个板子开的是dhcp，在一般情况下是够用的。如果想拿来做服务器，通常需要它有固定ip地址。一个简单的办法是在路由器上配，也就是在DHCP服务器上配这个mac地址为固定ip，这样就不用配pcd。一个小细节是pcd的mac地址每次刷机会变，所以刷机之后要重设。这样做的一个小缺点是万一DHCP服务器挂了，或是换了新路由器忘了设，就拿不到这个固定ip了。

如果要设置固定ip，首先要把rc.local里的dhcp部分去掉，不然怎么改interfaces都没用：

	sudo vi /etc/rc.local

在文件的最后找到这三行：

	#for ethernet over usb support
	dhcpd -pf /tmp/dhcpd.pid usb0
	dhclient eth0 &

把后面的两行也加上“#”：

	#for ethernet over usb support
	#dhcpd -pf /tmp/dhcpd.pid usb0
	#dhclient eth0 &

接下来：

	sudo vi /etc/network/interfaces
	
然后加入下面这段：

	# The primary network interface
	auto eth0
	iface eth0 inet static
	address 192.168.3.3
	gateway 192.168.3.1
	netmask 255.255.255.0
	network 192.168.3.0
	broadcast 192.168.3.255

当然ip地址要按照你的网络来设置。
还有域名解析的问题，打开/etc/resolve.conf:

	sudo vi /etc/resolv.conf 

把最后一行改掉：

	# Dynamic resolv.conf(5) file for glibc resolver(3) generated by resolvconf(8)
	#     DO NOT EDIT THIS FILE BY HAND -- YOUR CHANGES WILL BE OVERWRITTEN
	domain ec2.internal
	search ec2.internal
	nameserver 192.168.1.1
	#nameserver 172.16.0.23

但是这样还不够，有个叫做network-maneger的东西，每次启动都会改这个配置文件。所以还得再来：

	sudo vi /etc/init/network-manager.conf

然后，把下面这三行注释掉：

	start on (local-filesystems
	          and started dbus
	          and static-network-up)

#更新

虽然下载了最新的官网img，并不代表其中所有的程序都是最新的，首先修改一下原厂文件：

	sudo vi /etc/apt/sources.list

删除其中最后两行，这个网址里不再有更新包了。然后， 还需要两步：

	sudo apt-get update
	sudo apt-get upgrade

要小心的一点是，upgrade快结束的时候会提示lightdm的配置文件有新版本，你需要选择是采用新版本（y）还是保留旧版本（n），这时候需要采用默认选择，也就是保留旧版本（n）。否则的话，重启之后有可能无法进入GUI。

这个过程挺慢的，取决于你的网络，几十分钟是正常的。

#安装

总还需要安装一些程序的，这个就是每个人自己的选择了。


